# 🚀 CodeQuest 🚀

¡Bienvenido a CodeQuest! Una plataforma sencilla y escalable diseñada para ayudar a programadores junior a practicar y mejorar sus habilidades resolviendo retos de código en JavaScript y Python.

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
<!-- Add other badges if you have CI/CD, deployment status, etc. -->
<!-- Example: [![Netlify Status](https://api.netlify.com/api/v1/badges/YOUR_BADGE_ID/deploy-status)](https://app.netlify.com/sites/YOUR_SITE_NAME/deploys) -->

![CodeQuest Screenshot](public/screenshot.png) <!-- Optional: Add a screenshot -->

## 📜 Tabla de Contenidos

*   [✨ Características](#-características)
*   [🛠️ Tecnologías](#-tecnologías)
*   [⚙️ Instalación y Configuración](#-instalación-y-configuración)
    *   [Prerrequisitos](#prerrequisitos)
    *   [Clonar Repositorio](#clonar-repositorio)
    *   [Instalar Dependencias](#instalar-dependencias)
    *   [Configuración de Supabase](#configuración-de-supabase)
    *   [Variables de Entorno](#variables-de-entorno)
*   [🚀 Uso](#-uso)
*   [📂 Estructura del Proyecto](#-estructura-del-proyecto)
*   [🤝 Contribuir](#-contribuir)
*   [📄 Licencia](#-licencia)

## ✨ Características

*   **Exploración de Retos:** Busca y filtra retos por título, lenguaje (JavaScript/Python), nivel de dificultad y etiquetas.
*   **Editor de Código Integrado:** Escribe y prueba tu código directamente en el navegador con resaltado de sintaxis (`react-simple-code-editor` + Prism.js).
*   **Ejecución y Validación:** Ejecuta tu código contra casos de prueba predefinidos y obtén feedback inmediato.
*   **Historial Personal:** Revisa tus envíos anteriores, el código y los resultados obtenidos.
*   **Perfil de Usuario:** Visualiza tu progreso, estadísticas y retos completados.
*   **Ranking Global:** Compara tu puntuación con otros usuarios en la tabla de clasificación.
*   **Panel de Administración:** (Acceso restringido) Permite crear, editar y eliminar retos.
*   **Autenticación Segura:** Manejo de usuarios con Supabase Auth.
*   **Tema Claro/Oscuro:** Adaptación automática al tema del sistema operativo/navegador.

## 🛠️ Tecnologías

*   **Framework:** [Next.js](https://nextjs.org/) (App Router)
*   **Lenguaje:** [TypeScript](https://www.typescriptlang.org/)
*   **Backend & Base de Datos:** [Supabase](https://supabase.com/) (Auth, Postgres DB, Realtime)
*   **Estilos:** [Tailwind CSS](https://tailwindcss.com/)
*   **Editor de Código:** [react-simple-code-editor](https://github.com/satya164/react-simple-code-editor) + [Prism.js](https://prismjs.com/)
*   **Gestor de Paquetes:** npm / pnpm

## ⚙️ Instalación y Configuración

### Prerrequisitos

*   [Node.js](https://nodejs.org/) (v18 o superior recomendado)
*   [npm](https://www.npmjs.com/) o [pnpm](https://pnpm.io/)
*   Una cuenta gratuita en [Supabase](https://supabase.com/)

### Clonar Repositorio

```bash
git clone https://github.com/tu-usuario/codequest.git # Reemplaza con tu URL
cd codequest
```

### Instalar Dependencias

Elige tu gestor de paquetes preferido:

```bash
npm install
# o
pnpm install
```

### Configuración de Supabase

1.  **Crea un Proyecto en Supabase:** Ve a [supabase.com](https://supabase.com/) y crea un nuevo proyecto.
2.  **Esquema de Base de Datos:**
    *   Ve al "SQL Editor" en tu proyecto Supabase.
    *   Crea las tablas necesarias. Puedes usar el siguiente SQL como punto de partida (ajústalo según tus necesidades):

    ```sql
    -- Tabla para almacenar los retos
    CREATE TABLE challenges (
      id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
      created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
      titulo text NOT NULL,
      descripcion text,
      lenguaje text NOT NULL CHECK (lenguaje IN ('javascript', 'python')),
      nivel text NOT NULL CHECK (nivel IN ('Fácil', 'Medio', 'Difícil')),
      etiquetas text[],
      codigo_base text,
      test_cases jsonb -- Almacena los casos de prueba como JSON [{ "input": [...], "output": ... }, ...]
    );

    -- Tabla para almacenar los envíos de los usuarios
    CREATE TABLE submissions (
      id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
      created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
      user_id uuid REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
      challenge_id bigint REFERENCES challenges(id) ON DELETE CASCADE NOT NULL,
      codigo text,
      resultado jsonb -- Almacena los resultados como JSON ["Caso 1: ✅ Correcto", "Caso 2: ❌ Error..."]
    );

    -- Tabla para perfiles públicos (extendiendo auth.users)
    CREATE TABLE public_user_profiles (
      id uuid PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
      email text, -- Puedes almacenar el email aquí si necesitas mostrarlo públicamente
      is_admin boolean DEFAULT false NOT NULL -- Columna para marcar administradores
      -- Añade otros campos públicos si es necesario (ej. username, avatar_url)
    );

    -- Función para sincronizar perfiles al crear usuarios en auth.users
    CREATE OR REPLACE FUNCTION public.handle_new_user()
    RETURNS trigger
    LANGUAGE plpgsql
    SECURITY DEFINER SET search_path = public
    AS $$
    BEGIN
      INSERT INTO public.public_user_profiles (id, email)
      VALUES (new.id, new.email);
      RETURN new;
    END;
    $$;

    -- Trigger para ejecutar la función al crear un usuario
    CREATE TRIGGER on_auth_user_created
      AFTER INSERT ON auth.users
      FOR EACH ROW EXECUTE PROCEDURE public.handle_new_user();

    -- Habilitar lectura pública para retos
    ALTER TABLE challenges ENABLE ROW LEVEL SECURITY;
    CREATE POLICY "Allow public read access to challenges" ON challenges
      FOR SELECT USING (true);

    -- Habilitar lectura/escritura para envíos (solo el propio usuario)
    ALTER TABLE submissions ENABLE ROW LEVEL SECURITY;
    CREATE POLICY "Allow individual read access to submissions" ON submissions
      FOR SELECT USING (auth.uid() = user_id);
    CREATE POLICY "Allow individual insert access to submissions" ON submissions
      FOR INSERT WITH CHECK (auth.uid() = user_id);

    -- Habilitar lectura pública para perfiles
    ALTER TABLE public_user_profiles ENABLE ROW LEVEL SECURITY;
    CREATE POLICY "Allow public read access to profiles" ON public_user_profiles
      FOR SELECT USING (true);

    -- Políticas de Admin (Ejemplo: Solo admins pueden crear/modificar/eliminar retos)
    CREATE POLICY "Allow admin full access to challenges" ON challenges
      FOR ALL USING (public.is_user_admin(auth.uid())) WITH CHECK (public.is_user_admin(auth.uid()));

    -- Políticas de Admin (Ejemplo: Solo admins pueden leer todas las submissions)
    CREATE POLICY "Allow admin read access to all submissions" ON submissions
      FOR SELECT USING (public.is_user_admin(auth.uid()));

    -- Políticas de Admin (Ejemplo: Solo admins pueden modificar perfiles - ¡CUIDADO!)
    -- CREATE POLICY "Allow admin update access to profiles" ON public_user_profiles
    --   FOR UPDATE USING (public.is_user_admin(auth.uid())) WITH CHECK (public.is_user_admin(auth.uid()));

    -- Función auxiliar para verificar si un usuario es admin (requiere RLS en public_user_profiles)
    CREATE OR REPLACE FUNCTION public.is_user_admin(user_id uuid)
    RETURNS boolean
    LANGUAGE sql
    SECURITY DEFINER SET search_path = public -- Importante para que pueda leer is_admin
    AS $$
      SELECT EXISTS (
        SELECT 1
        FROM public_user_profiles p
        WHERE p.id = user_id AND p.is_admin = true
      );
    $$;

    ```

3.  **Políticas RLS (Row Level Security):** El SQL anterior incluye políticas básicas. **Asegúrate de entenderlas y ajustarlas a tus necesidades de seguridad.** Habilita RLS para cada tabla sensible.
4.  **Marcar Usuario como Admin:** Después de crear tu cuenta de usuario en la aplicación, ve a la tabla `public_user_profiles` en Supabase y cambia el valor de `is_admin` a `true` para tu usuario.

### Variables de Entorno

1.  **Encuentra tus Claves API:** En tu proyecto Supabase, ve a `Project Settings` > `API`.
2.  **Crea el archivo `.env.local`:** En la raíz de tu proyecto `codequest`, crea un archivo llamado `.env.local`.
3.  **Añade las variables:** Copia y pega tus claves API en el archivo `.env.local`:

    ```plaintext
    # .env.local
    NEXT_PUBLIC_SUPABASE_URL=TU_PROJECT_URL_DE_SUPABASE
    NEXT_PUBLIC_SUPABASE_ANON_KEY=TU_ANON_PUBLIC_KEY_DE_SUPABASE
    ```

    *   **`NEXT_PUBLIC_SUPABASE_URL`**: La URL de tu proyecto Supabase.
    *   **`NEXT_PUBLIC_SUPABASE_ANON_KEY`**: La clave anónima (pública) de tu proyecto. **Nunca compartas la clave `service_role` en el frontend.**

    *Nota: El archivo `.env.local` ya está incluido en `.gitignore` por defecto en proyectos Next.js, asegurando que no subas tus claves a GitHub.*

## 🚀 Uso

1.  **Inicia el Servidor de Desarrollo:**

    ```bash
    npm run dev
    # o
    pnpm dev
    ```

2.  **Abre la Aplicación:** Visita [`http://localhost:3000`](http://localhost:3000) en tu navegador.

## 📂 Estructura del Proyecto

```
codequest/
├── public/                 # Archivos estáticos (imágenes, fuentes)
│   └── screenshot.png      # (Opcional) Captura de pantalla
├── src/
│   ├── app/                # Rutas principales (App Router)
│   │   ├── (auth)/         # Rutas de autenticación (login, signup)
│   │   ├── admin/          # Rutas del panel de administración
│   │   │   ├── crear/
│   │   │   ├── retos/
│   │   │   └── submissions/
│   │   ├── historial/      # Página de historial de envíos
│   │   ├── perfil/         # Página de perfil de usuario
│   │   ├── ranking/        # Página de leaderboard
│   │   ├── retos/          # Página de listado de retos
│   │   │   └── [id]/       # Página de detalle y resolución de un reto
│   │   ├── globals.css     # Estilos globales
│   │   ├── layout.tsx      # Layout principal
│   │   └── page.tsx        # Página de inicio
│   ├── components/         # Componentes reutilizables (Navbar, Editor, etc.)
│   │   └── Navbar.tsx
│   ├── lib/                # Utilidades y configuración
│   │   ├── hooks/          # Hooks personalizados (useAuthUser, etc.)
│   │   └── supabase.ts     # Cliente Supabase
│   └── types/              # Definiciones de tipos TypeScript
│       └── index.ts
├── .env.local              # Variables de entorno (¡NO SUBIR A GIT!)
├── .gitignore              # Archivos ignorados por Git
├── next.config.js          # Configuración de Next.js
├── package.json            # Dependencias y scripts
├── postcss.config.js       # Configuración de PostCSS (para Tailwind)
├── tailwind.config.js      # Configuración de Tailwind CSS
├── tsconfig.json           # Configuración de TypeScript
└── README.md               # Este archivo
```

## 🤝 Contribuir

¡Las contribuciones son bienvenidas! Si quieres mejorar CodeQuest:

1.  Haz un **Fork** del repositorio.
2.  Crea una nueva **Branch** para tu feature: `git checkout -b feature/nueva-funcionalidad`.
3.  Realiza tus cambios y haz **Commit**: `git commit -m 'Añade nueva funcionalidad'`.
4.  Haz **Push** a tu branch: `git push origin feature/nueva-funcionalidad`.
5.  Abre un **Pull Request** describiendo tus cambios.

## 📄 Licencia

Este proyecto está bajo la [Licencia MIT](LICENSE). <!-- Asegúrate de tener un archivo LICENSE si mencionas una -->
